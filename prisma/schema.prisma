// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model User {
  id           String        @id @default(cuid())
  email        String        @unique
  passwordHash String
  firstName    String?
  lastName     String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  plaidItems   PlaidItem[]
  accounts     Account[]
  transactions Transaction[]
}

model PlaidItem {
  id                   String        @id @default(cuid())
  userId               String
  plaidItemId          String        @unique
  accessTokenEncrypted String
  institutionId        String?
  institutionName      String?
  cursor               String?
  lastSyncedAt         DateTime?
  createdAt            DateTime      @default(now())
  updatedAt            DateTime      @updatedAt
  user                 User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  accounts             Account[]
  transactions         Transaction[]

  @@index([userId])
}

model Account {
  id                   String        @id @default(cuid())
  userId               String
  plaidItemId          String
  plaidAccountId       String        @unique
  name                 String
  mask                 String?
  type                 String
  subtype              String?
  currentBalance       Decimal       @default(0)
  availableBalance     Decimal?
  isoCurrencyCode      String?
  unofficialCurrencyCode String?
  createdAt            DateTime      @default(now())
  updatedAt            DateTime      @updatedAt
  user                 User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  plaidItem            PlaidItem     @relation(fields: [plaidItemId], references: [id], onDelete: Cascade)
  transactions         Transaction[]

  @@index([userId])
  @@index([plaidItemId])
}

model Transaction {
  id                   String        @id @default(cuid())
  userId               String
  plaidItemId          String
  accountId            String
  plaidTransactionId   String        @unique
  pendingTransactionId String?
  amount               Decimal
  isoCurrencyCode      String?
  unofficialCurrencyCode String?
  date                 DateTime
  authorizedDate       DateTime?
  pending              Boolean
  paymentChannel       String?
  name                 String
  merchantName         String?
  primaryCategory      String?
  detailedCategory     String?
  locationJson         Json?
  counterpartiesJson   Json?
  rawJson              Json?
  createdAt            DateTime      @default(now())
  updatedAt            DateTime      @updatedAt
  user                 User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  plaidItem            PlaidItem     @relation(fields: [plaidItemId], references: [id], onDelete: Cascade)
  account              Account       @relation(fields: [accountId], references: [id], onDelete: Cascade)

  @@index([userId, date])
  @@index([accountId, date])
  @@index([plaidItemId, date])
  @@index([merchantName])
  @@index([primaryCategory])
}
